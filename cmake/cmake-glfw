INCLUDE(ExternalProject)

SET(GLFW_INSTALL_DIR ${CMAKE_BINARY_DIR}/glfw_install)

ExternalProject_Add(glfw
	PREFIX "${PROJECT_SOURCE_DIR}/lib/glfw"
    URL "https://github.com/glfw/glfw/archive/3.3.tar.gz"
    URL_MD5 "5be03812f5d109817e6558c3fab7bbe1"
    UPDATE_COMMAND ""
    CMAKE_ARGS
        "-DCMAKE_INSTALL_PREFIX=${CMAKE_BINARY_DIR}/glfw_install/"
        "-DCMAKE_BUILD_TYPE=Release"
        "-DGLFW_BUILD_EXAMPLES=OFF"
        "-DGLFW_BUILD_TESTS=OFF"
        "-DGLFW_BUILD_DOCS=OFF"
    CMAKE_CACHE_ARGS
        "-DCMAKE_C_COMPILER:FILEPATH=${CMAKE_C_COMPILER}"
        "-DCMAKE_CXX_COMPILER:FILEPATH=${CMAKE_CXX_COMPILER}"
    LOG_DOWNLOAD 1
	LOG_UPDATE 1
	LOG_CONFIGURE 1
	LOG_BUILD 1
	LOG_INSTALL 1
)

SET(GLFW_INCLUDE_DIR ${GLFW_INSTALL_DIR}/include)
SET(GLFW_LIBRARIES ${GLFW_INSTALL_DIR}/lib/${CMAKE_STATIC_LIBRARY_PREFIX}glfw3${CMAKE_STATIC_LIBRARY_SUFFIX})

IF(UNIX)
    FIND_PACKAGE(Threads REQUIRED)
    FIND_PACKAGE(X11 REQUIRED)

    IF(NOT X11_Xrandr_FOUND)
        MESSAGE(FATAL_ERROR "Xrandr library not found - required for GLFW")
    ENDIF()

    IF(NOT X11_xf86vmode_FOUND)
        MESSAGE(FATAL_ERROR "xf86vmode library not found - required for GLFW")
    ENDIF()

    IF(NOT X11_Xcursor_FOUND)
        MESSAGE(FATAL_ERROR "Xcursor library not found - required for GLFW")
    ENDIF()

    IF(NOT X11_Xinerama_FOUND)
        MESSAGE(FATAL_ERROR "Xinerama library not found - required for GLFW")
    ENDIF()

    IF(NOT X11_Xinput_FOUND)
        MESSAGE(FATAL_ERROR "Xinput library not found - required for GLFW")
    ENDIF()

    LIST(APPEND GLFW_LIBRARIES
        "${X11_Xrandr_LIB}" "${X11_Xxf86vm_LIB}" "${X11_Xcursor_LIB}"
        "${X11_Xinerama_LIB}" "${X11_Xinput_LIB}"
        "${CMAKE_THREAD_LIBS_INIT}" -lrt -ldl)
ENDIF()

SET(GLFW_INCLUDE_DIRS ${GLFW_INCLUDE_DIR} CACHE STRING "")
SET(GLFW_LIBRARIES ${GLFW_LIBRARIES} CACHE STRING "")
